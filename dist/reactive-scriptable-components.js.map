{"version":3,"file":"reactive-scriptable-components.js","sources":["../node_modules/tslib/tslib.es6.js","../src/reactive-scriptable-components.ts"],"sourcesContent":["/******************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise, SuppressedError, Symbol */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    if (typeof b !== \"function\" && b !== null)\r\n        throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __esDecorate(ctor, descriptorIn, decorators, contextIn, initializers, extraInitializers) {\r\n    function accept(f) { if (f !== void 0 && typeof f !== \"function\") throw new TypeError(\"Function expected\"); return f; }\r\n    var kind = contextIn.kind, key = kind === \"getter\" ? \"get\" : kind === \"setter\" ? \"set\" : \"value\";\r\n    var target = !descriptorIn && ctor ? contextIn[\"static\"] ? ctor : ctor.prototype : null;\r\n    var descriptor = descriptorIn || (target ? Object.getOwnPropertyDescriptor(target, contextIn.name) : {});\r\n    var _, done = false;\r\n    for (var i = decorators.length - 1; i >= 0; i--) {\r\n        var context = {};\r\n        for (var p in contextIn) context[p] = p === \"access\" ? {} : contextIn[p];\r\n        for (var p in contextIn.access) context.access[p] = contextIn.access[p];\r\n        context.addInitializer = function (f) { if (done) throw new TypeError(\"Cannot add initializers after decoration has completed\"); extraInitializers.push(accept(f || null)); };\r\n        var result = (0, decorators[i])(kind === \"accessor\" ? { get: descriptor.get, set: descriptor.set } : descriptor[key], context);\r\n        if (kind === \"accessor\") {\r\n            if (result === void 0) continue;\r\n            if (result === null || typeof result !== \"object\") throw new TypeError(\"Object expected\");\r\n            if (_ = accept(result.get)) descriptor.get = _;\r\n            if (_ = accept(result.set)) descriptor.set = _;\r\n            if (_ = accept(result.init)) initializers.unshift(_);\r\n        }\r\n        else if (_ = accept(result)) {\r\n            if (kind === \"field\") initializers.unshift(_);\r\n            else descriptor[key] = _;\r\n        }\r\n    }\r\n    if (target) Object.defineProperty(target, contextIn.name, descriptor);\r\n    done = true;\r\n};\r\n\r\nexport function __runInitializers(thisArg, initializers, value) {\r\n    var useValue = arguments.length > 2;\r\n    for (var i = 0; i < initializers.length; i++) {\r\n        value = useValue ? initializers[i].call(thisArg, value) : initializers[i].call(thisArg);\r\n    }\r\n    return useValue ? value : void 0;\r\n};\r\n\r\nexport function __propKey(x) {\r\n    return typeof x === \"symbol\" ? x : \"\".concat(x);\r\n};\r\n\r\nexport function __setFunctionName(f, name, prefix) {\r\n    if (typeof name === \"symbol\") name = name.description ? \"[\".concat(name.description, \"]\") : \"\";\r\n    return Object.defineProperty(f, \"name\", { configurable: true, value: prefix ? \"\".concat(prefix, \" \", name) : name });\r\n};\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    var desc = Object.getOwnPropertyDescriptor(m, k);\r\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\r\n        desc = { enumerable: true, get: function() { return m[k]; } };\r\n    }\r\n    Object.defineProperty(o, k2, desc);\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n}\r\n\r\nexport function __spreadArray(to, from, pack) {\r\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\r\n        if (ar || !(i in from)) {\r\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\r\n            ar[i] = from[i];\r\n        }\r\n    }\r\n    return to.concat(ar || Array.prototype.slice.call(from));\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: false } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\r\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\r\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\r\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\r\n}\r\n\r\nexport function __classPrivateFieldIn(state, receiver) {\r\n    if (receiver === null || (typeof receiver !== \"object\" && typeof receiver !== \"function\")) throw new TypeError(\"Cannot use 'in' operator on non-object\");\r\n    return typeof state === \"function\" ? receiver === state : state.has(receiver);\r\n}\r\n\r\nexport function __addDisposableResource(env, value, async) {\r\n    if (value !== null && value !== void 0) {\r\n        if (typeof value !== \"object\" && typeof value !== \"function\") throw new TypeError(\"Object expected.\");\r\n        var dispose;\r\n        if (async) {\r\n            if (!Symbol.asyncDispose) throw new TypeError(\"Symbol.asyncDispose is not defined.\");\r\n            dispose = value[Symbol.asyncDispose];\r\n        }\r\n        if (dispose === void 0) {\r\n            if (!Symbol.dispose) throw new TypeError(\"Symbol.dispose is not defined.\");\r\n            dispose = value[Symbol.dispose];\r\n        }\r\n        if (typeof dispose !== \"function\") throw new TypeError(\"Object not disposable.\");\r\n        env.stack.push({ value: value, dispose: dispose, async: async });\r\n    }\r\n    else if (async) {\r\n        env.stack.push({ async: true });\r\n    }\r\n    return value;\r\n}\r\n\r\nvar _SuppressedError = typeof SuppressedError === \"function\" ? SuppressedError : function (error, suppressed, message) {\r\n    var e = new Error(message);\r\n    return e.name = \"SuppressedError\", e.error = error, e.suppressed = suppressed, e;\r\n};\r\n\r\nexport function __disposeResources(env) {\r\n    function fail(e) {\r\n        env.error = env.hasError ? new _SuppressedError(e, env.error, \"An error was suppressed during disposal.\") : e;\r\n        env.hasError = true;\r\n    }\r\n    function next() {\r\n        while (env.stack.length) {\r\n            var rec = env.stack.pop();\r\n            try {\r\n                var result = rec.dispose && rec.dispose.call(rec.value);\r\n                if (rec.async) return Promise.resolve(result).then(next, function(e) { fail(e); return next(); });\r\n            }\r\n            catch (e) {\r\n                fail(e);\r\n            }\r\n        }\r\n        if (env.hasError) throw env.error;\r\n    }\r\n    return next();\r\n}\r\n\r\nexport default {\r\n    __extends: __extends,\r\n    __assign: __assign,\r\n    __rest: __rest,\r\n    __decorate: __decorate,\r\n    __param: __param,\r\n    __metadata: __metadata,\r\n    __awaiter: __awaiter,\r\n    __generator: __generator,\r\n    __createBinding: __createBinding,\r\n    __exportStar: __exportStar,\r\n    __values: __values,\r\n    __read: __read,\r\n    __spread: __spread,\r\n    __spreadArrays: __spreadArrays,\r\n    __spreadArray: __spreadArray,\r\n    __await: __await,\r\n    __asyncGenerator: __asyncGenerator,\r\n    __asyncDelegator: __asyncDelegator,\r\n    __asyncValues: __asyncValues,\r\n    __makeTemplateObject: __makeTemplateObject,\r\n    __importStar: __importStar,\r\n    __importDefault: __importDefault,\r\n    __classPrivateFieldGet: __classPrivateFieldGet,\r\n    __classPrivateFieldSet: __classPrivateFieldSet,\r\n    __classPrivateFieldIn: __classPrivateFieldIn,\r\n    __addDisposableResource: __addDisposableResource,\r\n    __disposeResources: __disposeResources,\r\n};\r\n","/*******************************************************************************\n*                                                                              *\n*           Reactive Scriptable Components (RSC, pronounced \"resc\")            *\n*                                                                              *\n*******************************************************************************/\n\nimport * as JIL from 'javascript-interface-library'\n\nimport {\n  throwError,\n  quoted,\n  ObjectIsEmpty,\n  ValueIsBoolean,\n  ValueIsNumber, ValueIsNumberInRange, ValueIsInteger, ValueIsIntegerInRange,\n  ValueIsString, ValueIsStringMatching, ValueIsTextline, ValueIsText,\n  ValueIsFunction,\n  ValueIsObject, ValueIsArray,\n  ValueIsListSatisfying,\n  ValueIsURL,\n  ValidatorForClassifier, acceptNil, rejectNil,\n  expectTextline, expectedTextline,\n  expectFunction,\n  allowListSatisfying,\n  expectInstanceOf,\n} from 'javascript-interface-library'\n\nimport { html }              from 'htm/preact'\nimport { render, Component } from 'preact'\n\nimport hyperactiv from 'hyperactiv'\nconst { observe, computed, dispose } = hyperactiv\n\n/**** hide all undefined custom elements (to avoid initial flashing) ****/\n\n  const Stylesheet = document.createElement('style')\n    Stylesheet.innerHTML = ':not(:defined) { visibility:hidden }'\n  document.head.appendChild(Stylesheet)\n\n/**** make some existing types indexable ****/\n\n  interface Indexable { [Key:string]:any }\n\n  type indexableFunction    = Function    & Indexable\n  type indexableElement     = Element     & Indexable\n  type indexableHTMLElement = HTMLElement & Indexable\n  type indexableEvent       = Event       & Indexable\n\nnamespace RSC {\n//------------------------------------------------------------------------------\n//--                             Type Definitions                             --\n//------------------------------------------------------------------------------\n\n  export type Textline = string              // mainly for illustrative purposes\n  export type Text     = string                                          // dto.\n  export type URL      = string                                          // dto.\n\n  export type RSC_Name = string                                          // dto.\n\n/**** throwReadOnlyError ****/\n\n  export function throwReadOnlyError (Name:string):never {\n    throwError(\n      'ReadOnlyProperty: property ' + quoted(Name) + ' must not be set'\n    )\n  }\n\n//------------------------------------------------------------------------------\n//--                 Classification and Validation Functions                  --\n//------------------------------------------------------------------------------\n\n/**** ValueIsDOMElement ****/\n\n  export function ValueIsDOMElement (Value:any):boolean {\n    return (Value instanceof Element)\n  }\n\n/**** allow/expect[ed]DOMElement ****/\n\n  export const allowDOMElement = ValidatorForClassifier(\n    ValueIsDOMElement, acceptNil, 'DOM element'\n  ), allowedDOMElement = allowDOMElement\n\n  export const expectDOMElement = ValidatorForClassifier(\n    ValueIsDOMElement, rejectNil, 'DOM element'\n  ), expectedDOMElement = expectDOMElement\n\n/**** ValueIsVisual ****/\n\n  export function ValueIsVisual (Value:any):boolean {\n    return (Value instanceof RSC_Visual)\n  }\n\n/**** allow/expect[ed]Visual ****/\n\n  export const allowVisual = ValidatorForClassifier(\n    ValueIsVisual, acceptNil, 'RSC visual'\n  ), allowedVisual = allowVisual\n\n  export const expectVisual = ValidatorForClassifier(\n    ValueIsVisual, rejectNil, 'RSC visual'\n  ), expectedVisual = expectVisual\n\n/**** ValueIsName ****/\n\n  const RSC_NamePattern = /^[a-z$_][a-z$_0-9]*(-[a-z$_0-9]+)*$/i\n\n  export function ValueIsName (Value:any):boolean {\n    return ValueIsStringMatching(Value, RSC_NamePattern)\n  }\n\n/**** allow/expect[ed]Name ****/\n\n  export const allowName = ValidatorForClassifier(\n    ValueIsName, acceptNil, 'RSC name'\n  ), allowedName = allowName\n\n  export const expectName = ValidatorForClassifier(\n    ValueIsName, rejectNil, 'RSC name'\n  ), expectedName = expectName\n\n/**** ValueIsErrorInfo ****/\n\n  export function ValueIsErrorInfo (Value:any):boolean {\n    return (\n      ValueIsObject(Value) &&\n      ValueIsTextline(Value.Title) &&\n      ValueIsText(Value.Message)\n    )\n  }\n\n/**** allow/expect[ed]ErrorInfo ****/\n\n  export const allowErrorInfo = ValidatorForClassifier(\n    ValueIsErrorInfo, acceptNil, 'RSC error information record'\n  ), allowedErrorInfo = allowErrorInfo\n\n  export const expectErrorInfo = ValidatorForClassifier(\n    ValueIsErrorInfo, rejectNil, 'RSC error information record'\n  ), expectedErrorInfo = expectErrorInfo\n\n//------------------------------------------------------------------------------\n//--                        Value Acceptance Functions                        --\n//------------------------------------------------------------------------------\n\n/**** acceptableBoolean ****/\n\n  export function acceptableBoolean (Value:any, Default:boolean):boolean {\n    return (ValueIsBoolean(Value) ? Value : Default)\n  }\n\n/**** acceptableNumber ****/\n\n  export function acceptableNumber (Value:any, Default:number) {\n    return (ValueIsNumber(Value) ? Value : Default)\n  }\n\n/**** acceptableNumberInRange ****/\n\n  export function acceptableNumberInRange (\n    Value:any, Default:number,\n    minValue:number = -Infinity, maxValue:number = Infinity,\n    withMin:boolean = false, withMax:boolean = false\n  ) {\n    return (\n      ValueIsNumberInRange(Value,minValue,maxValue,withMin,withMax) ? Value : Default\n    )\n  }\n\n/**** acceptableInteger ****/\n\n  export function acceptableInteger (Value:any, Default:number) {\n    return (ValueIsInteger(Value) ? Value : Default)\n  }\n\n/**** acceptableIntegerInRange ****/\n\n  export function acceptableIntegerInRange (\n    Value:any, Default:number,\n    minValue:number = -Infinity, maxValue:number = Infinity\n  ) {\n    return (ValueIsIntegerInRange(Value,minValue,maxValue) ? Value : Default)\n  }\n\n/**** acceptableString ****/\n\n  export function acceptableString (Value:any, Default:string) {\n    return (ValueIsString(Value) ? Value : Default)\n  }\n\n/**** acceptableNonEmptyString ****/\n\n  export function acceptableNonEmptyString (Value:any, Default:string) {\n    return (ValueIsString(Value) && (Value.trim() !== '') ? Value : Default)\n  }\n\n/**** acceptableStringMatching ****/\n\n  export function acceptableStringMatching (\n    Value:any, Default:string, Pattern:RegExp\n  ) {\n    return (ValueIsStringMatching(Value,Pattern) ? Value : Default)\n  }\n\n/**** acceptableURL ****/\n\n  export function acceptableURL (Value:any, Default:URL):URL {\n    return (ValueIsURL(Value) ? Value : Default)\n  }\n\n//------------------------------------------------------------------------------\n//--                      Initialization Marker Handling                      --\n//------------------------------------------------------------------------------\n\n  const InitializationMarkerForVisual:WeakMap<RSC_Visual,boolean> = new WeakMap()\n\n/**** VisualWasInitialized ****/\n\n  function VisualWasInitialized (Visual:RSC_Visual):boolean {\n    return (InitializationMarkerForVisual.get(Visual) === true)\n  }\n\n/**** markVisualAsInitialized ****/\n\n  function markVisualAsInitialized (Visual:RSC_Visual):void {\n    InitializationMarkerForVisual.set(Visual,true)\n  }\n\n//------------------------------------------------------------------------------\n//--                           Containment Handling                           --\n//------------------------------------------------------------------------------\n\n/**** outerVisualOf ****/\n\n  export function outerVisualOf (DOMElement:HTMLElement):RSC_Visual|undefined {\n    expectDOMElement('element',DOMElement)\n\n    DOMElement = DOMElement.parentElement as HTMLElement\n    while (DOMElement != null) {\n      if (ValueIsVisual(DOMElement)) {\n        return DOMElement as RSC_Visual\n      }\n      DOMElement = DOMElement.parentElement as HTMLElement\n    }\n\n    return undefined\n  }\n\n  export const VisualContaining = outerVisualOf\n\n/**** outermostVisualOf ****/\n\n  export function outermostVisualOf (DOMElement:HTMLElement):RSC_Visual|undefined {\n    expectDOMElement('element',DOMElement)\n\n    let outermostVisual:RSC_Visual|undefined = undefined\n      DOMElement = DOMElement.parentElement as HTMLElement\n      while (DOMElement != null) {\n        if (ValueIsVisual(DOMElement)) {\n          outermostVisual = DOMElement as RSC_Visual\n        }\n        DOMElement = DOMElement.parentElement as HTMLElement\n      }\n    return outermostVisual\n  }\n\n/**** closestVisualWithBehaviour ****/\n\n  export function closestVisualWithBehaviour (\n    DOMElement:HTMLElement, BehaviourName:RSC_Name\n  ):RSC_Visual|undefined {\n    expectDOMElement ('element',DOMElement)\n    expectName('behaviour name',BehaviourName)\n\n    const normalizedName = BehaviourName.toLowerCase()\n    while (DOMElement != null) {\n      if (\n        ValueIsVisual(DOMElement) &&\n        ((BehaviourNameOfVisual(DOMElement as RSC_Visual) || '').toLowerCase() === normalizedName)\n      ) {\n        return DOMElement as RSC_Visual\n      }\n      DOMElement = outerVisualOf(DOMElement) as HTMLElement\n    }\n    return undefined\n  }\n\n/**** closestVisualMatching ****/\n\n  export function closestVisualMatching (\n    DOMElement:HTMLElement, Selector:Textline\n  ):RSC_Visual|undefined {\n    expectDOMElement   ('element',DOMElement)\n    expectTextline('CSS selector',Selector)\n\n    while (DOMElement != null) {\n      if (ValueIsVisual(DOMElement) && DOMElement.matches(Selector)) {\n        return DOMElement as RSC_Visual\n      }\n      DOMElement = outerVisualOf(DOMElement) as HTMLElement\n    }\n    return undefined\n  }\n\n/**** innerElementsOf ****/\n\n  function innerElementsOf (DOMElement:HTMLElement):Element[] {\n    return Array.from(DOMElement.children)\n  }\n\n/**** innerVisualsOf ****/\n\n  export function innerVisualsOf (DOMElement:HTMLElement):RSC_Visual[] {\n    expectDOMElement('element',DOMElement)\n\n    const innerVisuals = Array.from(DOMElement.children)\n      .filter((innerElement) => ValueIsVisual(innerElement))\n    return innerVisuals as RSC_Visual[]\n  }\n\n//------------------------------------------------------------------------------\n//--                           Behaviour Management                           --\n//------------------------------------------------------------------------------\n\n  type RSC_BehaviourInfo = {\n    Name:RSC_Name,\n    AttributeSet:{[normalizedName:RSC_Name]:RSC_Name},\n    Source?:Text,\n    Executable?:Function,\n    Error?:RSC_ErrorInfo\n  }\n\n  type RSC_BehaviourRegistry = {\n    [normalizedName:RSC_Name]:RSC_BehaviourInfo\n  }\n\n/**** Behaviours are global ****/\n\n  const BehaviourRegistry:RSC_BehaviourRegistry = Object.create(null)\n\n/**** InfoForBehaviour ****/\n\n  function InfoForBehaviour (Name:RSC_Name):RSC_BehaviourInfo|undefined {\n    return BehaviourRegistry[Name.toLowerCase()]\n  }\n\n/**** registerBehaviour ****/\n\n  function registerBehaviour (\n    Name:RSC_Name, SourceOrExecutable:Text|Function,\n    observedAttributes:RSC_Name[] = []\n  ):void {\n    let normalizedName = Name.toLowerCase()\n\n    allowListSatisfying(\n      'list of observed element attributes', observedAttributes, ValueIsName\n    )\n\n    const AttributeSet = Object.create(null)\n    if (observedAttributes != null) {\n      observedAttributes.forEach(\n        (Name) => AttributeSet[Name.toLowerCase()] = Name\n      )\n      observedAttributes = observedAttributes.map((Name) => Name.toLowerCase())\n    }\n\n    if (ValueIsFunction(SourceOrExecutable)) {\n      BehaviourRegistry[normalizedName] = {\n        Name, AttributeSet, Executable:SourceOrExecutable as Function\n      }\n    } else {\n      if (normalizedName in BehaviourRegistry) {\n        const BehaviourInfo = BehaviourRegistry[normalizedName]\n        if (BehaviourInfo.Source == null) throwError(\n          'ForbiddenOperation: cannot overwrite intrinsic behaviour ' + quoted(Name)\n        )\n\n        if (BehaviourInfo.Source.trim() !== (SourceOrExecutable as Text).trim()) throwError(\n          'ForbiddenOperation: cannot overwrite existing behaviour ' + quoted(Name)\n        )\n      } else {\n        let Source = SourceOrExecutable as Text\n\n        let Executable:Function\n        try {\n          Executable = compiledScript(Source)\n        } catch (Signal) {\n          console.error(\n            `CompilationError: compilation of behaviour ${quoted(Name)} failed. ` +\n            'Reason: ' + Signal\n          )\n\n          BehaviourRegistry[normalizedName] = {\n            Name, AttributeSet, Source, Error:{\n              Title:'Compilation Failure',\n              Message:`Compilation of behaviour ${quoted(Name)} failed.\\n\\n` +\n                'Reason:' + Signal\n            }\n          }\n          return\n        }\n\n        BehaviourRegistry[normalizedName] = {\n          Name, AttributeSet, Source, Executable\n        }\n      }\n    }\n\n  /**** install a custom element for the given behaviour ****/\n\n    const customizedVisual = class extends RSC_Visual {\n      static observedAttributes:string[] = observedAttributes\n    }\n    customElements.define('rsc-' + normalizedName, customizedVisual)\n  }\n\n  BehaviourRegistry['visual'] = {\n    Name:'Visual', AttributeSet:{ value:'Value' }\n  }\n\n/**** registerBehaviourFromElement ****/\n\n  function registerBehaviourFromElement (ScriptElement:Element):void {\n    let Name = expectedName(\n      'behaviour name',ScriptElement.getAttribute('for-behaviour')\n    )\n    if (Name.toLowerCase() === 'visual') throwError(\n      'ReservedName: behaviour name \"visual\" is reserved for internal use'\n    )\n\n    let Source = ScriptElement.innerHTML\n\n    let observedAttributes:RSC_Name[] = (\n      (ScriptElement.getAttribute('observed-attributes') || '')\n      .split(/\\s*(?:,|$)\\s*/).filter((Name) => (Name || '').trim() !== '')\n    )\n    if (! ValueIsListSatisfying(observedAttributes,ValueIsName)) throwError(\n      'Invalidargument: attribute \"observed-attributes\" does not contain a ' +\n      'list of valid RSC attribute names'\n    )\n\n    registerBehaviour(Name,Source,observedAttributes)\n\n    permitVisualsWithinBehaviour(\n      Name, ScriptElement.getAttribute('permitted-contents') || ''\n    )\n\n    forbidVisualsWithinBehaviour(\n      Name, ScriptElement.getAttribute('fobidden-contents') || ''\n    )\n  }\n\n/**** registerAllBehavioursFoundInHead ****/\n\n  function registerAllBehavioursFoundInHead ():void {\n    innerElementsOf(document.head).forEach((Element) => {\n      if (Element.matches('script[type=\"rsc-script\"][for-behaviour]')) {\n        registerBehaviourFromElement(Element)\n      }\n    })\n  }\n\n/**** registerAllBehavioursFoundInVisual ****/\n\n  function registerAllBehavioursFoundInVisual (Visual:RSC_Visual):void {\n    innerElementsOf(Visual).forEach((Element) => {\n      if (Element.matches('script[type=\"rsc-script\"][for-behaviour]')) {\n        registerBehaviourFromElement(Element)\n      }\n    })\n  }\n\n//registerAllBehavioursFoundInHead()           // not yet, only after RSC_Visual\n\n/**** BehaviourNameOfVisual ****/\n\n  function BehaviourNameOfVisual (Visual:RSC_Visual):RSC_Name|undefined {\n    let BehaviourName = Visual.tagName.slice(4).toLowerCase()\n    if (BehaviourName === 'visual') {\n      BehaviourName = Visual.getAttribute('behaviour') as string\n      return (ValueIsName(BehaviourName) ? BehaviourName : 'visual')\n    } else {\n      return InfoForBehaviour(BehaviourName)?.Name || BehaviourName\n    }\n  }\n\n//------------------------------------------------------------------------------\n//--                    Content and Containment Validation                    --\n//------------------------------------------------------------------------------\n\n  type RSC_SelectorSet = {[BehaviourName:RSC_Name]:string}\n\n  const permittedVisualsSelectorWithinBehaviour:RSC_SelectorSet = Object.create(null)\n  const forbiddenVisualsSelectorWithinBehaviour:RSC_SelectorSet = Object.create(null)\n\n/**** permitVisualsWithinBehaviour ****/\n\n  function permitVisualsWithinBehaviour (\n    BehaviourName:RSC_Name, Selector:string\n  ):void {\n    Selector = Selector.trim()\n    if (Selector !== '') {\n      const normalizedBehaviourName = BehaviourName.toLowerCase()\n      permittedVisualsSelectorWithinBehaviour[normalizedBehaviourName] = Selector\n    }\n  }\n\n/**** forbidVisualsWithinBehaviour ****/\n\n  function forbidVisualsWithinBehaviour (\n    BehaviourName:RSC_Name, Selector:string\n  ):void {\n    Selector = Selector.trim()\n    if (Selector !== '') {\n      const normalizedBehaviourName = BehaviourName.toLowerCase()\n      forbiddenVisualsSelectorWithinBehaviour[normalizedBehaviourName] = Selector\n    }\n  }\n\n/**** validateContentsOfVisual ****/\n\n  function validateContentsOfVisual (Visual:RSC_Visual):void {\n    const BehaviourName = BehaviourNameOfVisual(Visual)\n    if (BehaviourName == null) { return }\n\n    const normalizedBehaviourName = BehaviourName.toLowerCase()\n    let permittedVisualsSelector = permittedVisualsSelectorWithinBehaviour[normalizedBehaviourName]\n    let forbiddenVisualsSelector = forbiddenVisualsSelectorWithinBehaviour[normalizedBehaviourName]\n\n    if ((permittedVisualsSelector != null) || (forbiddenVisualsSelector != null)) {\n      innerVisualsOf(Visual).forEach((innerVisual) => {\n        if ((\n          (permittedVisualsSelector != null) &&\n          ! innerVisual.matches(permittedVisualsSelector)\n        ) || (\n          (forbiddenVisualsSelector != null) &&\n          innerVisual.matches(forbiddenVisualsSelector)\n        )) {\n          innerVisual.remove()\n        }\n      })\n    }\n  }\n\n/**** validateContainerOfVisual ****/\n\n  function validateContainerOfVisual (Visual:RSC_Visual):void {\n    const Container = outerVisualOf(Visual)\n    if (Container == null) { return }\n\n    const BehaviourName = BehaviourNameOfVisual(Container)\n    if (BehaviourName == null) { return }\n\n    const normalizedBehaviourName = BehaviourName.toLowerCase()\n\n    let permittedVisualsSelector = permittedVisualsSelectorWithinBehaviour[normalizedBehaviourName]\n    if (permittedVisualsSelector != null) {\n      if (! Visual.matches(permittedVisualsSelector)) throwError(\n        'InacceptableInnerVisual: the given visual is not allowed to become a ' +\n        'part of its container'\n      )\n    }\n\n    let forbiddenVisualsSelector = forbiddenVisualsSelectorWithinBehaviour[normalizedBehaviourName]\n    if (forbiddenVisualsSelector != null) {\n      if (Visual.matches(forbiddenVisualsSelector)) throwError(\n        'InacceptableInnerVisual: the given visual is not allowed to become a ' +\n        'part of its container'\n      )\n    }\n  }\n\n//------------------------------------------------------------------------------\n//--                       Script Delegation Management                       --\n//------------------------------------------------------------------------------\n\n  type RSC_Selector = Textline\n\n  type RSC_ScriptDelegationInfo = {\n    Selector:RSC_Selector,\n    Source:Text,\n    Executable:Function,\n    Error?:RSC_ErrorInfo\n  }\n\n  type RSC_ScriptDelegationSet = {[Selector:RSC_Selector]:RSC_ScriptDelegationInfo}\n\n  const ScriptDelegationSetForVisual:WeakMap<RSC_Visual,RSC_ScriptDelegationSet> = new WeakMap()\n\n/**** registerDelegatedScriptInVisual ****/\n\n  function registerDelegatedScriptInVisual (\n    Visual:RSC_Visual, Selector:RSC_Selector, Source:Text\n  ):void {\n    let ScriptDelegationSet = ScriptDelegationSetForVisual.get(Visual)\n    if (ScriptDelegationSet == null) {\n      ScriptDelegationSetForVisual.set(Visual,ScriptDelegationSet = Object.create(null))\n    }\n\n    if (Selector in (ScriptDelegationSet as RSC_ScriptDelegationSet)) throwError(\n      'ForbiddenOperation: a script for elements matching selector ' +\n      quoted(Selector) + ' exists already'\n    )\n\n    let Executable:Function\n    try {\n      Executable = compiledScript(Source)\n    } catch (Signal) {\n      throwError(\n        'CompilationError: compilation of delegated script for elements ' +\n        'matching selector ' + quoted(Selector) + ' failed. ' +\n        'Reason: ' + Signal\n      )\n    }\n\n    (ScriptDelegationSet as RSC_ScriptDelegationSet)[Selector] = { Selector, Source, Executable }\n  }\n\n/**** registerDelegatedScriptFromElement ****/\n\n  function registerDelegatedScriptFromElement (\n    Visual:RSC_Visual, ScriptElement:Element\n  ):void {\n    let Selector = expectedTextline(\n      'element selector',ScriptElement.getAttribute('for')\n    )\n\n    let Script = ScriptElement.innerHTML\n\n    registerDelegatedScriptInVisual(Visual, Selector, Script)\n  }\n\n/**** registerAllDelegatedScriptsFoundInVisual ****/\n\n  function registerAllDelegatedScriptsFoundInVisual (Visual:RSC_Visual):void {\n    innerElementsOf(Visual).forEach((Element) => {\n      if (Element.matches('script[type=\"rsc-script\"][for]')) {\n        registerDelegatedScriptFromElement(Visual,Element)\n      }\n    })\n  }\n\n/**** delegatedScriptInfoForVisual ****/\n\n  function delegatedScriptInfoForVisual (\n    Visual:RSC_Visual\n  ):RSC_ScriptDelegationInfo|undefined {\n    let ScriptContainer = Visual\n    while (ScriptContainer != null) {\n      let ScriptDelegationSet = ScriptDelegationSetForVisual.get(ScriptContainer)\n      if (ScriptDelegationSet != null) {\n        for (const Selector in ScriptDelegationSet) {\n          if (Visual.matches(Selector)) {\n            return ScriptDelegationSet[Selector]\n          }\n        }\n      }\n\n      ScriptContainer = outerVisualOf(ScriptContainer) as RSC_Visual\n    }\n  }\n\n//------------------------------------------------------------------------------\n//--                             Script Handling                              --\n//------------------------------------------------------------------------------\n\n/**** ScriptOfVisual ****/\n\n  function ScriptOfVisual (Visual:RSC_Visual):Text|undefined {\n    let Script = Visual.getAttribute('script') || ''\n    return (Script.trim() === '' ? undefined : Script)\n  }\n\n/**** ScriptInVisual ****/\n\n  function ScriptInVisual (Visual:RSC_Visual):Text|undefined {\n    const ScriptList = innerElementsOf(Visual)\n    for (let i = 0, l = ScriptList.length; i < l; i++) {\n      let Candidate = ScriptList[i]\n      if (\n        (Candidate.tagName === 'SCRIPT') &&\n        ((Candidate.getAttribute('type') || '') === 'rsc-script') &&\n        ! Candidate.hasAttribute('for') && ! Candidate.hasAttribute('for-behaviour')\n      ) { return Candidate.innerHTML }\n    }\n  }\n\n/**** compiledScript - throws on failure ****/\n\n  function compiledScript (Script:Text):Function {\n    return new Function(\n      'RSC,JIL, onAttributeChange, onAttachment,onDetachment, toRender,' +\n      'html, on,once,off,trigger, reactively',\n      Script || ''\n    )                                                                // may fail!\n  }\n\n/**** applyExecutable - throws on failure ****/\n\n  function applyExecutable (Visual:RSC_Visual, Executable:Function):void {\n    const onAttributeChange = Visual.onAttributeChange.bind(Visual)\n    const onAttachment      = Visual.onAttachment     .bind(Visual)\n    const onDetachment      = Visual.onDetachment     .bind(Visual)\n    const toRender          = Visual.toRender         .bind(Visual)\n\n  /**** on ****/\n\n    function on (\n      Events:string, SelectorOrHandler:string|String|null|Function,\n      DataOrHandler?:any, Handler?:Function\n    ):void {\n      registerEventHandlerForVisual(\n        Visual, Events,SelectorOrHandler,DataOrHandler,Handler\n      )\n    }\n\n  /**** once ****/\n\n    function once (\n      Events:string, SelectorOrHandler:string|String|null|Function,\n      DataOrHandler?:any, Handler?:Function\n    ):void {\n      registerEventHandlerForVisual(\n        Visual, Events,SelectorOrHandler,DataOrHandler,Handler, 'once'\n      )\n    }\n\n  /**** off ****/\n\n    function off (\n      Events?:string, SelectorOrHandler?:string|String|null|Function,\n      Handler?:Function\n    ):void {\n      let ArgList = Array.prototype.slice.call(arguments,1)\n\n      Events = (Events || '').trim().replace(/\\s+/g,' ')\n      if (Events === '') {\n        unregisterAllMatchingEventHandlersFromVisual(Visual)\n        return\n      }\n\n      let Selector:string = (\n        ValueIsString(ArgList[0])\n        ? (ArgList.shift() as string).trim()\n        : (ArgList[0] === null ? ArgList.shift() || '' : undefined)\n      )          // \"null\" means: no selector, \"undefined\" means: any selector\n\n      Handler = ArgList.shift()\n      if (Handler == null) {\n        unregisterAllMatchingEventHandlersFromVisual(Visual,Events,Selector)\n      } else {\n        unregisterAllMatchingEventHandlersFromVisual(Visual,Events,Selector,Handler)\n      }\n    }\n\n  /**** trigger ****/\n\n    function trigger (\n      EventToTrigger:string|Event, Arguments:any[],\n      bubbles = true\n    ):boolean {\n      Arguments = (ValueIsArray(Arguments) ? Arguments.slice() : [])\n\n      switch (true) {\n        case ValueIsString(EventToTrigger):\n          EventToTrigger = new CustomEvent(\n            EventToTrigger as string, {\n              bubbles, cancelable:true, detail:{ Arguments }\n            }\n          )\n          break\n        case (EventToTrigger instanceof Event):\n          EventToTrigger = new CustomEvent((EventToTrigger as Event).type,\n            Object.assign({}, EventToTrigger, {\n              bubbles, cancelable:true , detail:{ Arguments }\n            })\n          )\n          break\n        default: debugger; throwError(\n          'InvalidArgument: Event instance or literal event type expected'\n        )\n      }\n\n      Visual.dispatchEvent(EventToTrigger as CustomEvent)\n\n      const EventDetails = (EventToTrigger as CustomEvent).detail\n      if (EventDetails?.Error == null) {\n        return EventDetails?.Result\n      } else {\n        throw EventDetails?.Error\n      }\n    }\n\n  /**** reactively ****/\n\n    function reactively (reactiveFunction:Function) {\n      expectFunction('reactive function',reactiveFunction)\n// @ts-ignore we definitely want the function argument to be accepted\n      registerReactiveFunctionIn(Visual,computed(reactiveFunction))\n    }\n\n  /**** run \"Executable\" in the context of \"Visual\" ****/\n\n    Executable.apply(Visual, [\n      RSC,JIL, onAttributeChange, onAttachment,onDetachment, toRender,\n      html, on,once,off,trigger, reactively\n    ])\n  }\n\n/**** applyBehaviourScriptOfVisual ****/\n\n  function applyBehaviourScriptOfVisual (Visual:RSC_Visual):void {\n    const BehaviourName = BehaviourNameOfVisual(Visual)\n    if (BehaviourName == null) { return }\n\n    const BehaviourInfo = InfoForBehaviour(BehaviourName)\n    if (BehaviourInfo == null) {\n      setErrorOfVisual(Visual,{\n        Title:'Missing Behaviour',\n        Message:'Behaviour ' + quoted(BehaviourName) + ' could not be found'\n      })\n      return\n    }\n\n    if (BehaviourInfo.Error != null) {\n      setErrorOfVisual(Visual,BehaviourInfo.Error)\n      return\n    }\n\n    const Executable = BehaviourInfo.Executable as Function\n    if (Executable == null) { return }\n\n    try {\n      applyExecutable(Visual,Executable)\n    } catch (Signal) {\nconsole.error(Signal)\n      setErrorOfVisual(Visual,{\n        Title:'Execution Failure',\n        Message:'Script of behaviour ' + quoted(BehaviourName) + ' could not ' +\n                'be executed.\\n\\nReason:\\n' + Signal\n      })\n      return\n    }\n  }\n\n/**** applyElementScriptOfVisual ****/\n\n  function applyElementScriptOfVisual (Visual:RSC_Visual):void {\n    const Script = ScriptOfVisual(Visual) || ScriptInVisual(Visual)\n    if (Script != null) {\n      let Executable\n      try {\n        Executable = compiledScript(Script)\n      } catch (Signal) {\nconsole.error(Signal)\n        setErrorOfVisual(Visual,{\n          Title:'Compilation Failure',\n          Message:'Visual script could not be compiled.\\n\\nReason:\\n' + Signal\n        })\n      }\n\n      try {\n        applyExecutable(Visual,Executable as Function)\n      } catch (Signal) {\nconsole.error(Signal)\n        setErrorOfVisual(Visual,{\n          Title:'Execution Failure',\n          Message:'Visual script could not be executed.\\n\\nReason:\\n' + Signal\n        })\n      }\n      return\n    }\n\n    const ScriptDelegationInfo = delegatedScriptInfoForVisual(Visual)\n    if (ScriptDelegationInfo != null) {\n      if (ScriptDelegationInfo.Error != null) {\n        setErrorOfVisual(Visual,ScriptDelegationInfo.Error)\n        return\n      }\n\n      try {\n        applyExecutable(Visual,ScriptDelegationInfo.Executable)\n      } catch (Signal) {\nconsole.error(Signal)\n        setErrorOfVisual(Visual,{\n          Title:'Execution Failure',\n          Message:'delegated visual script with selector ' +\n            quoted(ScriptDelegationInfo.Selector) + ' could not be ' +\n            'executed.\\n\\nReason:\\n' + Signal\n        })\n        return\n      }\n    }\n  }\n\n//------------------------------------------------------------------------------\n//--                              Event Handling                              --\n//------------------------------------------------------------------------------\n\n/**** ValueIsEventNameWithSelector ****/\n\n  const RSC_NameWithSelectorPattern = /^[a-z$_][a-z$_0-9]*([-.:][a-z$_0-9]+)*@.*$/i\n\n  function ValueIsEventNameWithSelector (Value:any):boolean {\n    return ValueIsStringMatching(Value,RSC_NameWithSelectorPattern)\n  }\n\n/**** registerEventHandlerForVisual ****/\n\n  function registerEventHandlerForVisual (\n    Visual:RSC_Visual,\n    Events:string, SelectorOrHandler?:string|String|null|Function,\n    DataOrHandler?:any, Handler?:Function, once?:'once'\n  ):void {\n    let ArgList = Array.prototype.slice.call(arguments,1)\n\n    Events = ArgList.shift().trim().replace(/\\s+/g,' ')\n    if (Events === '') { return }\n\n    let Selector:string = (\n      ValueIsString(ArgList[0])\n      ? (ArgList.shift() as string).trim()\n      : (ArgList[0] == null ? ArgList.shift() || '' : '')\n    )                                                   // '' means: no selector\n\n    let Data:any = (\n      typeof ArgList[1] === 'function'\n      ? ArgList.shift()\n      : undefined\n    )\n\n    Handler = ArgList.shift() as Function\n\n    _registerEventHandlerForVisual(\n      Visual, Events,Selector,Data,Handler, once\n    )\n  }\n\n/**** _registerEventHandlerForVisual ****/\n\n  const EventRegistryForVisual:WeakMap<RSC_Visual,object> = new WeakMap()\n\n  function _registerEventHandlerForVisual (\n    Visual:RSC_Visual,\n    Events:string, Selector:string|String, Data:any,\n    Handler:Function, once?:'once'\n  ):void {\n  /**** actualHandler ****/\n\n    function actualHandler (Event:indexableEvent):void {\n      switch (Selector) {\n        case '':\n          break\n        case '@this':\n          if (Event.target !== Event.currentTarget) { return }\n          break\n        default:\n          if (! (Event.target as Element).matches(Selector as string)) { return }\n      }\n\n      if (Data != null) { Event.data = Data }\n\n      if (once) {\n        unregisterAllMatchingEventHandlersFromVisual(\n          Visual, Event.type,Selector,Handler\n        )\n      }\n\n      let ArgList = [Event].concat(Event.detail?.Arguments || [])\n      try {\n        const Result = Handler.apply(Visual,ArgList)\n        if (Result !== undefined) {\n          ;(Event.detail || {}).Result = Result\n\n          Event.stopImmediatePropagation()\n          Event.preventDefault()\n        }\n      } catch (Signal) {\n        ;(Event.detail || {}).Error = Signal\n\n        Event.stopImmediatePropagation()\n        Event.preventDefault()\n      }\n    }\n    (actualHandler as indexableFunction)['isFor'] = Handler\n\n    let EventList:string[]\n    if (ValueIsEventNameWithSelector(Events)) {\n      let AtIndex = Events.indexOf('@')\n      EventList = [Events.slice(0,AtIndex)]\n      Selector  = Events.slice(AtIndex+1)\n        if (Selector === 'this') { Selector = '@this' }          // special case\n    } else {\n      EventList = Events.split(' ')\n    }\n\n    let EventRegistry:Indexable = EventRegistryForVisual.get(Visual) as Indexable\n    if (EventRegistry == null) {\n      EventRegistryForVisual.set(Visual,EventRegistry = Object.create(null))\n    }\n\n    EventList.forEach((Event) => {\n      let EntriesForEvent:Indexable = (EventRegistry as Indexable)[Event]\n      if (EntriesForEvent == null) {\n        EntriesForEvent = (EventRegistry as Indexable)[Event] = Object.create(null)\n      }\n\n      let EntriesForSelector:Function[] = EntriesForEvent[Selector as string]\n      if (EntriesForSelector == null) {\n        EntriesForSelector = EntriesForEvent[Selector as string] = []\n      }\n\n      EntriesForSelector.push(actualHandler)\n      Visual.addEventListener(Event,actualHandler)\n    })\n  }\n\n/**** unregisterAllMatchingEventHandlersFromVisual ****/\n\n  function unregisterAllMatchingEventHandlersFromVisual (\n    Visual:RSC_Visual,\n    Events?:string, Selector?:string|String|null, Handler?:Function\n  ):void {\n    let EventList:string[]\n    if (ValueIsEventNameWithSelector(Events)) {\n      let AtIndex = (Events as string).indexOf('@')\n      EventList = [(Events as string).slice(0,AtIndex)]\n      Selector  = (Events as string).slice(AtIndex+1)\n    } else {\n      EventList = (Events == null ? [] : Events.split(' '))\n    }\n\n    const EventRegistry = EventRegistryForVisual.get(Visual)\n    if (EventRegistry == null) { return }\n\n    if (EventList.length === 0) {               // unregister any event handlers\n      for (let Event in EventRegistry) {\n        unregisterMatchingEventHandlersFromVisual(\n          Visual, Event,Selector,Handler\n        )\n      }\n    } else {                    // unregister handlers for the given events only\n      EventList.forEach((Event:string) => {\n        unregisterMatchingEventHandlersFromVisual(\n          Visual, Event,Selector,Handler\n        )\n      })\n    }\n  }\n\n/**** unregisterMatchingEventHandlersFromVisual ****/\n\n  function unregisterMatchingEventHandlersFromVisual (\n    Visual:RSC_Visual,\n    Event:string, Selector?:string|String|null, Handler?:Function\n  ):void {\n    const EventRegistry:Indexable = EventRegistryForVisual.get(Visual) as Indexable\n    if (EventRegistry == null) { return }\n\n    let EntriesForEvent:Indexable = EventRegistry[Event]\n    if (EntriesForEvent != null) {\n      if (Selector == null) {\n        for (let Selector in EntriesForEvent) {\n          unregisterMatchingEventSelectorHandlersFromVisual(\n            Visual, EntriesForEvent, Event,Selector,Handler\n          )\n        }\n      } else {\n        unregisterMatchingEventSelectorHandlersFromVisual(\n          Visual, EntriesForEvent, Event,Selector,Handler\n        )\n      }\n\n      if (ObjectIsEmpty(EntriesForEvent)) {\n        delete EventRegistry[Event]\n      }\n    }\n  }\n\n/**** unregisterMatchingEventSelectorHandlersFromVisual ****/\n\n  function unregisterMatchingEventSelectorHandlersFromVisual (\n    Visual:RSC_Visual,\n    EntriesForEvent:any, Event:string, Selector:string|String, Handler?:Function\n  ):void {\n    let EntriesForSelector:Function[] = EntriesForEvent[Selector as string]\n    if (EntriesForSelector != null) {\n      if (Handler == null) {\n        EntriesForSelector.forEach((actualHandler:Function) => {\n// @ts-ignore TypeScript does not allow JS functions here, but that's wrong\n          Visual.removeEventListener(Event,actualHandler)\n        })\n        EntriesForSelector.length = 0\n      } else {\n        EntriesForSelector.every((actualHandler:indexableFunction, Index:number) => {\n          if (actualHandler['isFor'] === Handler) {\n// @ts-ignore TypeScript does not allow JS functions here, but that's wrong\n            Visual.removeEventListener(Event,actualHandler)\n            EntriesForSelector.splice(Index,1)\n            return false\n          }\n          return true\n        })\n      }\n\n      if (EntriesForSelector.length === 0) {\n        delete EntriesForEvent[Selector as string]\n      }\n    }\n  }\n\n//------------------------------------------------------------------------------\n//--                           Reactivity Handling                            --\n//------------------------------------------------------------------------------\n\n  const reactiveFunctionsForVisual:WeakMap<RSC_Visual,Function[]>  = new WeakMap()\n  const reactiveAttributesForVisual:WeakMap<RSC_Visual,Function[]> = new WeakMap()\n\n/**** ObservableOfVisual ****/\n\n  const ObservableForVisual:WeakMap<RSC_Visual,Indexable> = new WeakMap()\n\n  function ObservableOfVisual (Visual:RSC_Visual):Indexable {\n    let Observable = ObservableForVisual.get(Visual)\n    if (Observable == null) {\n      ObservableForVisual.set(Visual, Observable = observe({},{ deep:false }))\n    }\n    return Observable as Indexable\n  }\n\n/**** UnobservedOfVisual ****/\n\n  const UnobservedForVisual:WeakMap<RSC_Visual,Indexable> = new WeakMap()\n\n  function UnobservedOfVisual (Visual:RSC_Visual):Indexable {\n    let Unobserved = UnobservedForVisual.get(Visual)\n    if (Unobserved == null) {\n      UnobservedForVisual.set(Visual, Unobserved = {})\n    }\n    return Unobserved as Indexable\n  }\n\n/**** startReactiveRenderingOfVisual ****/\n\n  const reactiveRendererForVisual:WeakMap<RSC_Visual,Function> = new WeakMap()\n\n  function startReactiveRenderingOfVisual (Visual:RSC_Visual):void {\n    reactiveRendererForVisual.set(Visual,computed(Visual.render.bind(Visual)))\n  }\n\n/**** stopReactiveRenderingOfVisual ****/\n\n  function stopReactiveRenderingOfVisual (Visual:RSC_Visual):void {\n    const Renderer = reactiveRendererForVisual.get(Visual)\n    if (Renderer != null) {\n      dispose(Renderer)\n      reactiveRendererForVisual.delete(Visual)\n    }\n  }\n\n/**** ValueIsReactiveAttributeName ****/\n\n  function ValueIsReactiveAttributeName (Value:any):boolean {\n    return (\n      ValueIsString(Value) && (\n        Value.startsWith('$')  && ValueIsName(Value.slice(1)) ||\n        Value.startsWith('$$') && ValueIsName(Value.slice(2))\n      )\n    )\n  }\n\n/**** updateAttributeOfVisual (non-reactive attributes only) ****/\n\n  function updateAttributeOfVisual (\n    Visual:RSC_Visual, normalizedName:RSC_Name, newValue:string|undefined\n  ):void {\n    let AttributeChangeHandler = AttributeChangeHandlerForVisual.get(Visual)\n    if (AttributeChangeHandler == null) {\n      const BehaviourName = BehaviourNameOfVisual(Visual)\n      if (BehaviourName == null) { return }\n\n      const Behaviour = InfoForBehaviour(BehaviourName)\n      if (Behaviour == null) { return }\n\n      const AttributeSet = Behaviour.AttributeSet\n      if (normalizedName in AttributeSet) {\n        const originalName = AttributeSet[normalizedName]\n        try {\n          Visual.observed[originalName] = newValue\n        } catch (Signal) {\n          setErrorOfVisual(Visual,{\n            Title:'Attribute Change Failure',\n            Message:(\n              'could not update observed property \"' +\n              quoted(originalName) + '\" upon a change of attribute \"' +\n              quoted(normalizedName) + '\"'\n            )\n          })\n        }\n      }\n    } else {\n      try {\n        AttributeChangeHandler.call(Visual, normalizedName, newValue)\n      } catch (Signal) {\n        setErrorOfVisual(Visual,{\n          Title:'Attribute Change Handler Failure',\n          Message:'Running the configured attribute change handler failed\\n\\n' +\n                  'Reason: ' + Signal\n        })\n      }\n    }\n  }\n\n/**** updateAllAttributesOfVisual (non-reactive attributes only) ****/\n\n  function updateAllAttributesOfVisual (Visual:RSC_Visual):void {\n    Array.from(Visual.attributes).forEach((Attribute) => {\n      const normalizedName = Attribute.name\n      if (ValueIsName(normalizedName)) {      // ignores all reactive attributes\n        updateAttributeOfVisual(Visual,normalizedName,Attribute.value)\n      }\n    })\n  }\n\n/**** registerAllReactiveAttributesOfVisual ****/\n\n  function registerAllReactiveAttributesOfVisual (Visual:RSC_Visual):void {\n    Array.from(Visual.attributes).forEach((Attribute) => {\n      const reactiveName = Attribute.name\n      if (ValueIsReactiveAttributeName(reactiveName)) {\n        const BehaviourName = BehaviourNameOfVisual(Visual)\n        if (BehaviourName == null) { return }\n\n        const Behaviour = InfoForBehaviour(BehaviourName)\n        if (Behaviour == null) { return }\n\n        const normalizedName = reactiveName.replace(/^[$]{1,2}/,'')\n\n        const AttributeSet = Behaviour.AttributeSet\n        if (normalizedName in AttributeSet) {\n          const originalName = AttributeSet[normalizedName]\n\n          const { Base,PathList } = parsedAccessPathFromVisual(\n            Visual, Attribute.value\n          )\n\n          let HandlerList:Function[] = reactiveAttributesForVisual.get(Visual) as Function[]\n          if (HandlerList == null) {\n            reactiveAttributesForVisual.set(Visual,HandlerList = [])\n          }\n\n          if (reactiveName.startsWith('$$')) {\n            const Handler = computed(() => {\n              setValueOfReactiveVariable(\n                Base, PathList, Visual.observed[originalName]\n              )\n            })\n            HandlerList.push(Handler)\n          }\n\n          const Handler = computed(() => {\n            Visual.observed[originalName] = ValueOfReactiveVariable(Base, PathList)\n          })\n          HandlerList.push(Handler)\n        }\n      }\n    })\n  }\n\n/**** parsedAccessPathFromVisual ****/\n\n  type RSC_AccessPath = {\n    Base:RSC_Visual,\n    PathList:string[]\n  }\n\n  const    dottedIndexPattern = /^\\s*[.]([^.\\[]+)/\n  const  unquotedIndexPattern = /^\\s*\\[([^'\"\\]]+)\\]/\n  const sglquotedIndexPattern = /^\\s*\\[\\s*'(([^'\\\\]|\\\\([\"'\\\\\\/bfnrt]|x[0-9a-f]{2}|u[0-9a-f]{4}))*)'\\s*\\]/i\n  const dblquotedIndexPattern = /^\\s*\\[\\s*\"(([^\"\\\\]|\\\\([\"'\\\\\\/bfnrt]|x[0-9a-f]{2}|u[0-9a-f]{4}))*)\"\\s*\\]/i\n\n  function parsedAccessPathFromVisual (\n    Visual:RSC_Visual, literalPath:string\n  ):RSC_AccessPath {\n    const SplitIndex = literalPath.indexOf(':observed')\n    if (SplitIndex < 0) throwError(\n      'InvalidAccessPath:invalid access path ' + quoted(literalPath)\n    )\n\n    let Selector = literalPath.slice(0,SplitIndex)\n    if (ValueIsName(Selector)) {\n      const normalizedName = Selector.toLowerCase()\n      Selector = `rsc-${normalizedName},[behaviour=\"${normalizedName}\"]`\n    }\n\n    let Base = closestVisualMatching(Visual,Selector)\n    if (Base == null) throwError(\n      'NoSuchVisual:could not find a close visual matching CSS selector' +\n      quoted(Selector)\n    )\n\n    let AccessPath = literalPath.slice(SplitIndex + 9).trim()\n\n    const PathList:string[] = []; let Match\n    while (AccessPath !== '') {\n      switch (true) {\n        case (Match =   dottedIndexPattern.exec(AccessPath)) != null:\n        case (Match = unquotedIndexPattern.exec(AccessPath)) != null:\n// @ts-ignore 18048: we know that Match is not null\n          PathList.push(Match[1].trim())\n// @ts-ignore 18048: we know that Match is not null\n          AccessPath = AccessPath.slice(Match[0].length).trim()\n          break\n        case (Match = sglquotedIndexPattern.exec(AccessPath)) != null:\n        case (Match = dblquotedIndexPattern.exec(AccessPath)) != null:\n// @ts-ignore 18048: we know that Match is not null\n          PathList.push(Match[1])\n// @ts-ignore 18048: we know that Match is not null\n          AccessPath = AccessPath.slice(Match[0].length).trim()\n          break\n        default:\n          throwError('InvalidAccessPath:invalid access path ' + quoted(literalPath))\n      }\n    }\n\n    return { Base,PathList }\n  }\n\n/**** ValueOfReactiveVariable ****/\n\n  function ValueOfReactiveVariable (Base:RSC_Visual, PathList:string[]):any {\n    let Value:any = Base.observed[PathList[0]]\n      for (let i = 1, l = PathList.length; i < l; i++) {\n        if (Value == null) throwError(\n          'InvalidAccess:cannot access variable bound to reactive attribute'\n        )\n        Value = Value[PathList[i]]\n      }\n    return Value\n  }\n\n/**** setValueOfReactiveVariable ****/\n\n  function setValueOfReactiveVariable (\n    Base:RSC_Visual, PathList:string[], Value:any\n  ):void {\n    let Variable:Indexable = Base as Indexable\n      for (let i = 0, l = PathList.length-1; i < l; i++) {\n        if (Variable == null) throwError(\n          'InvalidAccess:cannot access variable bound to reactive attribute'\n        )\n        Variable = Variable[PathList[i]]\n      }\n    Variable[PathList[-1]] = Value\n  }\n\n/**** unregisterAllReactiveAttributesOfVisual ****/\n\n  function unregisterAllReactiveAttributesOfVisual (Visual:RSC_Visual):void {\n    let HandlerList:Function[] = reactiveAttributesForVisual.get(Visual) as Function[]\n    if (HandlerList == null) { return }\n\n    HandlerList.forEach((Handler) => {\n      dispose(Handler)\n    })\n  }\n\n/**** registerReactiveFunctionIn ****/\n\n  function registerReactiveFunctionIn (\n    Visual:RSC_Visual, reactiveFunction:Function\n  ):void {\n    let reactiveFunctions = reactiveFunctionsForVisual.get(Visual)\n    if (reactiveFunctions == null) {\n      reactiveFunctionsForVisual.set(Visual,reactiveFunctions = [])\n    }\n    reactiveFunctions.push(reactiveFunction)\n  }\n\n/**** unregisterAllReactiveFunctionsFrom ****/\n\n  function unregisterAllReactiveFunctionsFrom (Visual:RSC_Visual):void {\n    let reactiveFunctions = reactiveFunctionsForVisual.get(Visual)\n    if (reactiveFunctions == null) { return }\n\n    reactiveFunctions.forEach((reactiveFunction) => {\n      dispose(reactiveFunction)\n    })\n  }\n\n//------------------------------------------------------------------------------\n//--                              Error Handling                              --\n//------------------------------------------------------------------------------\n\n  type RSC_ErrorInfo = {\n    Title:Textline,\n    Message:Text\n  }\n\n  const ErrorInfoForVisual:WeakMap<RSC_Visual,RSC_ErrorInfo> = new WeakMap()\n\n/**** setErrorOfVisual ****/\n\n  function setErrorOfVisual (\n    Visual:RSC_Visual, ErrorInfo:RSC_ErrorInfo|undefined\n  ):void {\n    expectErrorInfo('RSC error info record',ErrorInfo)\n\n    if (ErrorInfoForVisual.get(Visual) == null) {\n      ErrorInfoForVisual.set(Visual,ErrorInfo as RSC_ErrorInfo)\n      Visual.render()\n    }\n  }\n\n/**** ErrorOfVisual ****/\n\n  function ErrorOfVisual (Visual:RSC_Visual):RSC_ErrorInfo|undefined {\n    return ErrorInfoForVisual.get(Visual)\n  }\n\n/**** RSC_ErrorIndicator ****/\n\n  function RSC_ErrorIndicator (PropSet:Indexable) {\n    const Visual = PropSet.visual\n\n    function onClick (Event:Event) {\n      showErrorInfoForVisual(Visual)\n    }\n\n    return html`\n      <style>\n        .RSC-ErrorIndicator {\n          display:block; position:absolute; overflow:hidden;\n          left:0px; top:0px; width:24px; height:24px;\n          background:url(\"data:image/svg+xml,%3C%3Fxml version='1.0' encoding='utf-8'%3F%3E%3Csvg width='24px' height='24px' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M12 17.0001H12.01M12 10.0001V14.0001M6.41209 21.0001H17.588C19.3696 21.0001 20.2604 21.0001 20.783 20.6254C21.2389 20.2985 21.5365 19.7951 21.6033 19.238C21.6798 18.5996 21.2505 17.819 20.3918 16.2579L14.8039 6.09805C13.8897 4.4359 13.4326 3.60482 12.8286 3.32987C12.3022 3.09024 11.6978 3.09024 11.1714 3.32987C10.5674 3.60482 10.1103 4.4359 9.19614 6.09805L3.6082 16.2579C2.74959 17.819 2.32028 18.5996 2.39677 19.238C2.46351 19.7951 2.76116 20.2985 3.21709 20.6254C3.7396 21.0001 4.63043 21.0001 6.41209 21.0001Z' stroke='orange' stroke-width='2' stroke-linecap='round' stroke-linejoin='round' fill='white'/%3E%3C/svg%3E\");\n          pointer-events:auto;\n        }\n      </style>\n      <div class=\"RSC-ErrorIndicator\" onClick=${onClick}></div>\n    `\n  }\n\n/**** showErrorInfoForVisual ****/\n\n  function showErrorInfoForVisual (Visual:RSC_Visual):void {\n    const { Title,Message } = ErrorOfVisual(Visual) as RSC_ErrorInfo\n    window.alert(Title + '\\n\\n' + Message)\n  }\n\n//------------------------------------------------------------------------------\n//--                                RSC_Visual                                --\n//------------------------------------------------------------------------------\n\n  const ShadowRootForVisual:WeakMap<RSC_Visual,any> = new WeakMap()\n\n  const AttributeChangeHandlerForVisual:WeakMap<RSC_Visual,Function> = new WeakMap()\n  const AttachmentHandlerForVisual:WeakMap<RSC_Visual,Function>      = new WeakMap()\n  const DetachmentHandlerForVisual:WeakMap<RSC_Visual,Function>      = new WeakMap()\n  const RendererForVisual:WeakMap<RSC_Visual,Function>               = new WeakMap()\n\n  const DummyHandler = () => {}\n\n  class RSC_Visual extends HTMLElement {\n    static observedAttributes:string[] = ['value']         // may be overwritten\n\n  /**** constructor ****/\n\n    public constructor () {       // already with all attributes and inner nodes\n      super()\n\n      const ShadowRoot = this.attachShadow({ mode:'closed' })\n      ShadowRootForVisual.set(this,ShadowRoot)\n    }\n\n  /**** connectedCallback - elements are added from the outside in ****/\n\n    public connectedCallback () {\n      validateContainerOfVisual(this)    // throws if inacceptable for container\n\n      if (VisualWasInitialized(this)) {\n        unregisterAllReactiveAttributesOfVisual(this)\n        registerAllReactiveAttributesOfVisual(this)\n      } else {\n        registerAllBehavioursFoundInVisual(this)\n        registerAllDelegatedScriptsFoundInVisual(this)\n\n        validateContentsOfVisual(this)\n\n        applyBehaviourScriptOfVisual(this)\n        applyElementScriptOfVisual(this)\n\n        updateAllAttributesOfVisual(this)    // setters should be defined by now\n        registerAllReactiveAttributesOfVisual(this)\n\n        markVisualAsInitialized(this)             // outer visuals are now known\n      }\n\n      startReactiveRenderingOfVisual(this)                   // also renders now\n\n      let AttachmentHandler = AttachmentHandlerForVisual.get(this)\n      if (AttachmentHandler != null) {\n        try {\n          AttachmentHandler.call(this)\n        } catch (Signal) {\n          setErrorOfVisual(this,{\n            Title:'Attachment Handler Failure',\n            Message:'Running the configured attachment handler failed\\n\\n' +\n                    'Reason: ' + Signal\n          })\n        }\n      }\n    }\n\n  /**** disconnectedCallback - elements are removed from the outside in ****/\n\n    public disconnectedCallback () {\n      startReactiveRenderingOfVisual(this)\n\n//    unregisterAllReactiveFunctionsFrom(this) // TODO: better before removal\n      unregisterAllReactiveAttributesOfVisual(this)\n\n      let DetachmentHandler = DetachmentHandlerForVisual.get(this)\n      if (DetachmentHandler != null) {\n        try {\n          DetachmentHandler.call(this)\n        } catch (Signal) {\n          setErrorOfVisual(this,{\n            Title:'Detachment Handler Failure',\n            Message:'Running the configured detachment handler failed\\n\\n' +\n                    'Reason: ' + Signal\n          })\n        }\n      }\n    }\n\n  /**** attributeChangedCallback ****/\n\n    public attributeChangedCallback (\n      normalizedName:string, oldValue:string, newValue:string\n    ) {\n      if (VisualWasInitialized(this) && ! ValueIsReactiveAttributeName(normalizedName)) {\n        updateAttributeOfVisual(this, normalizedName, newValue)\n      }\n    }\n\n  /**** observed ****/\n\n    public get observed ():Indexable  { return ObservableOfVisual(this) }\n    public set observed (_:Indexable) { throwReadOnlyError('observable') }\n\n  /**** unobserved ****/\n\n    public get unobserved ():Indexable  { return UnobservedOfVisual(this) }\n    public set unobserved (_:Indexable) { throwReadOnlyError('unobserved') }\n\n  /**** onAttributeChange (originalName, newValue) ****/\n\n    public onAttributeChange (newHandler:Function):void {\n      expectFunction('visual attribute change handler',newHandler)\n      AttributeChangeHandlerForVisual.set(this,newHandler)\n    }\n\n  /**** onAttachment () ****/\n\n    public onAttachment (newHandler:Function):void {\n      expectFunction('visual attachment handler',newHandler)\n      AttachmentHandlerForVisual.set(this,newHandler)\n    }\n\n  /**** onDetachment () ****/\n\n    public onDetachment (newHandler:Function):void {\n      expectFunction('visual detachment handler',newHandler)\n      DetachmentHandlerForVisual.set(this,newHandler) || DummyHandler\n    }\n\n  /**** Renderer ****/\n\n    public toRender (newHandler:Function) {\n      expectFunction('visual renderer',newHandler)\n      RendererForVisual.set(this,newHandler)\n    }\n\n  /**** render ****/\n\n    public render ():void {\n      if (VisualWasInitialized(this)) {\n        let Rendering\n        if (! this.hasError) {\n          const Renderer = RendererForVisual.get(this)\n          if (Renderer == null) {\n            if (this.tagName === 'RSC-VISUAL') {\n              Rendering = html`${this.observed['Value']}<slot/>`\n            }\n          } else {\n            try {\n              Rendering = Renderer.call(this)\n            } catch (Signal) {\n              setErrorOfVisual(this,{\n                Title:'Rendering Failure',\n                Message:'Running the configured renderer failed, reason: ' + Signal\n              })\n            }\n          }\n        }\n\n        const ShadowRoot = ShadowRootForVisual.get(this)\n        if (this.hasError) {\n          render(html`<${RSC_ErrorIndicator} visual=${this}/>`,ShadowRoot)\n        } else {\n          render(html`${Rendering}`,ShadowRoot)\n        }\n      }\n    }\n\n  /**** hasError ****/\n\n    public get hasError ():boolean  { return (this.Error != null) }\n    public set hasError (_:boolean) { throwReadOnlyError('hasError') }\n\n  /**** Error ****/\n\n    public get Error ():RSC_ErrorInfo|undefined {\n      return ErrorOfVisual(this)\n    }\n    public set Error (ErrorInfo:RSC_ErrorInfo|undefined) {\n      setErrorOfVisual(this,ErrorInfo)\n    }\n  }\n\n  customElements.define('rsc-visual', RSC_Visual)\n\n  registerAllBehavioursFoundInHead()\n}\n"],"names":["extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","prototype","hasOwnProperty","call","__extends","TypeError","String","__","this","constructor","create","__makeTemplateObject","cooked","raw","defineProperty","value","SuppressedError","RSC","observe","hyperactiv","computed","dispose","Stylesheet","document","createElement","innerHTML","head","appendChild","throwReadOnlyError","Name","throwError","quoted","ValueIsDOMElement","Value","Element","ValueIsVisual","RSC_Visual","allowDOMElement","ValidatorForClassifier","acceptNil","allowedDOMElement","expectDOMElement","rejectNil","expectedDOMElement","allowVisual","allowedVisual","expectVisual","expectedVisual","RSC_NamePattern","ValueIsName","ValueIsStringMatching","ValueIsErrorInfo","ValueIsObject","ValueIsTextline","Title","ValueIsText","Message","allowName","allowedName","expectName","expectedName","allowErrorInfo","allowedErrorInfo","expectErrorInfo","expectedErrorInfo","acceptableBoolean","Default","ValueIsBoolean","acceptableNumber","ValueIsNumber","acceptableNumberInRange","minValue","maxValue","withMin","withMax","Infinity","ValueIsNumberInRange","acceptableInteger","ValueIsInteger","acceptableIntegerInRange","ValueIsIntegerInRange","acceptableString","ValueIsString","acceptableNonEmptyString","trim","acceptableStringMatching","Pattern","acceptableURL","ValueIsURL","InitializationMarkerForVisual","WeakMap","VisualWasInitialized","Visual","get","outerVisualOf","DOMElement","parentElement","closestVisualMatching","Selector","expectTextline","matches","innerElementsOf","from","children","innerVisualsOf","filter","innerElement","VisualContaining","outermostVisualOf","outermostVisual","undefined","closestVisualWithBehaviour","BehaviourName","normalizedName","toLowerCase","BehaviourNameOfVisual","BehaviourRegistry","InfoForBehaviour","registerBehaviourFromElement","ScriptElement","getAttribute","Source","observedAttributes","split","ValueIsListSatisfying","SourceOrExecutable","allowListSatisfying","AttributeSet","forEach","map","ValueIsFunction","Executable","BehaviourInfo","compiledScript","Signal","console","error","concat","Error","customizedVisual","_a","_super","class_1","customElements","define","registerBehaviour","normalizedBehaviourName","permittedVisualsSelectorWithinBehaviour","permitVisualsWithinBehaviour","forbiddenVisualsSelectorWithinBehaviour","forbidVisualsWithinBehaviour","tagName","slice","ScriptDelegationSetForVisual","registerDelegatedScriptFromElement","ScriptDelegationSet","set","registerDelegatedScriptInVisual","expectedTextline","Script","Function","applyExecutable","onAttributeChange","bind","onAttachment","onDetachment","toRender","apply","JIL","html","Events","SelectorOrHandler","DataOrHandler","Handler","registerEventHandlerForVisual","ArgList","arguments","replace","shift","unregisterAllMatchingEventHandlersFromVisual","EventToTrigger","Arguments","bubbles","ValueIsArray","CustomEvent","cancelable","detail","Event","type","assign","dispatchEvent","EventDetails","Result","reactiveFunction","expectFunction","reactiveFunctions","reactiveFunctionsForVisual","push","registerReactiveFunctionIn","applyElementScriptOfVisual","ScriptOfVisual","ScriptList","i","l","length","Candidate","hasAttribute","ScriptInVisual","ScriptDelegationInfo","ScriptContainer","delegatedScriptInfoForVisual","setErrorOfVisual","RSC_NameWithSelectorPattern","ValueIsEventNameWithSelector","once","Data","actualHandler","target","currentTarget","data","stopImmediatePropagation","preventDefault","EventList","AtIndex","indexOf","EventRegistry","EventRegistryForVisual","EntriesForEvent","EntriesForSelector","addEventListener","_registerEventHandlerForVisual","Event_1","unregisterMatchingEventHandlersFromVisual","Selector_1","unregisterMatchingEventSelectorHandlersFromVisual","ObjectIsEmpty","removeEventListener","every","Index","splice","reactiveAttributesForVisual","ObservableForVisual","UnobservedForVisual","reactiveRendererForVisual","startReactiveRenderingOfVisual","render","ValueIsReactiveAttributeName","startsWith","updateAttributeOfVisual","newValue","AttributeChangeHandler","AttributeChangeHandlerForVisual","Behaviour","originalName","observed","registerAllReactiveAttributesOfVisual","attributes","Attribute","reactiveName","name","originalName_1","literalPath","SplitIndex","Base","Match","AccessPath","PathList","dottedIndexPattern","exec","unquotedIndexPattern","sglquotedIndexPattern","dblquotedIndexPattern","parsedAccessPathFromVisual","Base_1","PathList_1","HandlerList","Handler_1","Variable","setValueOfReactiveVariable","ValueOfReactiveVariable","unregisterAllReactiveAttributesOfVisual","ErrorInfoForVisual","ErrorInfo","ErrorOfVisual","RSC_ErrorIndicator","PropSet","visual","templateObject_1","window","alert","showErrorInfoForVisual","ShadowRootForVisual","AttachmentHandlerForVisual","DetachmentHandlerForVisual","RendererForVisual","_this","ShadowRoot","attachShadow","mode","connectedCallback","Container","permittedVisualsSelector","forbiddenVisualsSelector","validateContainerOfVisual","registerAllDelegatedScriptsFoundInVisual","innerVisual","remove","validateContentsOfVisual","applyBehaviourScriptOfVisual","updateAllAttributesOfVisual","markVisualAsInitialized","AttachmentHandler","disconnectedCallback","DetachmentHandler","attributeChangedCallback","oldValue","Observable","deep","_","Unobserved","newHandler","Rendering","hasError","Renderer","templateObject_2","ShadowRoot_1","templateObject_3","templateObject_4","HTMLElement"],"mappings":"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"}